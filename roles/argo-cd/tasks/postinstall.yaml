---
- name: Role Post-Install
  when:
    - inventory_hostname in k3s_map.server.hosts
    - argocd_map.metrics.service.monitor.enabled is truthy
  run_once: true
  include_tasks: roles/_common/tasks/postinstall_metrics.yaml
  vars:
    component_name: "argocd"
    chart_ref: "{{ argocd_map.helm.chart.reference }}"
    chart_version: "{{ argocd_vars.kubernetes.helm.chart.version }}"
    chart_name: "{{ argocd_vars.kubernetes.helm.chart.name }}"
    chart_namespace: "{{ argocd_vars.kubernetes.namespace }}"
    chart_timeout: "{{ argocd_map.helm.timeout }}"
    chart_values: "{{ lookup('ansible.builtin.template', 'values.j2') | from_yaml }}"
