# roles/common/templates/http_route_secure.j2
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: {{ service_name }}-https
  namespace: {{ service_namespace }}
spec:
  hostnames:
    - {{ service_subdomain }}.{% if service_access|default(global_map.services.default_access) == "internal" %}{{ global_map.domains.internal }}{% else %}{{ global_map.domains.external }}{% endif %}
  parentRefs:
    - kind: Gateway
      name: {{ service_name }}
      namespace: {{ service_namespace }}
      sectionName: https
  rules:
    - backendRefs:
        - kind: Service
          name: {{ backend_service_name }}
          port: {{ backend_service_port }}
      matches:
        - path:
            type: PathPrefix
            value: /