---
- name: Role Facts
  ansible.builtin.include_role:
    name: "{{ role }}"
    tasks_from: facts
  loop:
    - external-dns
    - k3s
    - victoria-metrics
    - kubernetes-dashboard
  loop_control:
    loop_var: role

- name: Role Validation
  when: ('validation' in ansible_run_tags)
  run_once: true
  block:
    # Use the common validation task
    - name: Validate Kubernetes Dashboard
      include_tasks: roles/_common/tasks/validation.yaml
      vars:
        project_url: "{{ kubernetes_dashboard_project.url }}/{{ kubernetes_dashboard_project.tag }}"
        release_name: "{{ kubernetes_dashboard_vars.kubernetes.helm.chart.name }}"
        namespace: "{{ kubernetes_dashboard_vars.kubernetes.namespace }}"
        expected_version: "{{ kubernetes_dashboard_map.helm.chart.version }}"
